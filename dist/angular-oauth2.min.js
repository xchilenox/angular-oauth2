!function(e,t){"function"==typeof define&&define.amd?define(["angular","query-string"],t):"object"==typeof exports?module.exports=t(require("angular"),require("query-string")):e.angularOAuth2=t(e.angular,e.queryString)}(this,function(e,t){function n(e){e.interceptors.push("oauthInterceptor")}function r(t,n,r,o){var a=function(e){return r.getAuthorizationHeader()&&(e.headers=e.headers||{},e.headers.Authorization=r.getAuthorizationHeader()),e},i=function(a){var i=t.reject(a);if(e.isObject(a.data)||(a.data=JSON.parse(a.data)),400!==a.status||!a.data||"invalid_request"!==a.data.error&&"invalid_grant"!==a.data.error||(r.removeToken(),n.$emit("oauth:error",a)),(401===a.status&&a.data&&"invalid_token"===a.data.error||a.headers("www-authenticate")&&0===a.headers("www-authenticate").indexOf("Bearer"))&&n.$emit("oauth:error",a),401===a.status&&a.data&&"access_denied"===a.data.error||a.headers("www-authenticate")&&0===a.headers("www-authenticate").indexOf("Bearer")){var u=t.defer();o.append(a.config,u),n.$emit("oauth:error",a),i=u.promise}return i},u={request:a,responseError:i};return u}function o(){var n;this.configure=function(t){if(n)throw new Error("Already configured.");if(!(t instanceof Object))throw new TypeError("Invalid argument: `config` must be an `Object`.");return n=e.extend({},s,t),e.forEach(f,function(e){if(!n[e])throw new Error("Missing parameter: "+e+".")}),"/"===n.baseUrl.substr(-1)&&(n.baseUrl=n.baseUrl.slice(0,-1)),"/"!==n.grantPath[0]&&(n.grantPath="/"+n.grantPath),"/"!==n.revokePath[0]&&(n.revokePath="/"+n.revokePath),n},this.$get=function(r,o,a,i,u){var c=function(){function i(){if(!n)throw new Error("`OAuthProvider` must be configured first.")}return l(i,null,{isAuthenticated:{value:function(){return!!a.getToken()},writable:!0,enumerable:!0,configurable:!0},getAccessToken:{value:function(r,i){if(!r||!r.username||!r.password)throw new Error("`user` must be an object with `username` and `password` properties.");var u={client_id:n.clientId,grant_type:"password",username:r.username,password:r.password};return null!==n.clientSecret&&(u.client_secret=n.clientSecret),u=t.stringify(u),i=e.extend({headers:{"Content-Type":"application/x-www-form-urlencoded"}},i),o.post(""+n.baseUrl+n.grantPath,u,i).then(function(e){return a.setToken(e.data),e})},writable:!0,enumerable:!0,configurable:!0},getFacebookAccessToken:{value:function(r,i){if(!r||!r.id||!r.email)throw new Error("`user` must be an object with `id` and `email` properties.");var u={client_id:n.clientId,grant_type:"facebook",id:r.id,email:r.email};return null!==n.clientSecret&&(u.client_secret=n.clientSecret),u=t.stringify(u),i=e.extend({headers:{"Content-Type":"application/x-www-form-urlencoded"}},i),o.post(""+n.baseUrl+n.grantPath,u,i).then(function(e){return a.setToken(e.data),e})},writable:!0,enumerable:!0,configurable:!0},getRefreshToken:{value:function(){var e={client_id:n.clientId,grant_type:"refresh_token",refresh_token:a.getRefreshToken()};null!==n.clientSecret&&(e.client_secret=n.clientSecret),e=t.stringify(e);var r={headers:{"Content-Type":"application/x-www-form-urlencoded"}};return o.post(""+n.baseUrl+n.grantPath,e,r).then(function(e){return a.setToken(e.data),e})},writable:!0,enumerable:!0,configurable:!0},getRefreshTokenAndRetryRequests:{value:function(){return r.isRefreshingToken?void 0:(r.isRefreshingToken=!0,this.getRefreshToken().then(function(){u.loginConfirmed()},function(){u.loginCancelled()}))},writable:!0,enumerable:!0,configurable:!0},revokeToken:{value:function(){var e=t.stringify({token:a.getRefreshToken()?a.getRefreshToken():a.getAccessToken()}),r={headers:{"Content-Type":"application/x-www-form-urlencoded"}};return o.post(""+n.baseUrl+n.revokePath,e,r).then(function(e){return a.removeToken(),e})},writable:!0,enumerable:!0,configurable:!0}}),i}();return new c},this.$get.$inject=["$rootScope","$http","OAuthToken","httpBuffer","authManager"]}function a(){var t={name:"token"};this.configure=function(n){if(!(n instanceof Object))throw new TypeError("Invalid argument: `config` must be an `Object`.");return e.extend(t,n),t},this.$get=function(e){var n=function(){function n(){}return l(n,null,{setToken:{value:function(n){return e.putObject(t.name,n)},writable:!0,enumerable:!0,configurable:!0},getToken:{value:function(){return e.getObject(t.name)},writable:!0,enumerable:!0,configurable:!0},getAccessToken:{value:function(){return this.getToken()?this.getToken().access_token:void 0},writable:!0,enumerable:!0,configurable:!0},getAuthorizationHeader:{value:function(){return this.getTokenType()&&this.getAccessToken()?""+(this.getTokenType().charAt(0).toUpperCase()+this.getTokenType().substr(1))+" "+this.getAccessToken():void 0},writable:!0,enumerable:!0,configurable:!0},getRefreshToken:{value:function(){return this.getToken()?this.getToken().refresh_token:void 0},writable:!0,enumerable:!0,configurable:!0},getTokenType:{value:function(){return this.getToken()?this.getToken().token_type:void 0},writable:!0,enumerable:!0,configurable:!0},removeToken:{value:function(){return e.remove(t.name)},writable:!0,enumerable:!0,configurable:!0}}),n}();return new n},this.$get.$inject=["$localStorage"]}function i(e,t){var n=function(n,r){var o=r||function(e){return e};t.retryAll(o),e.$broadcast("oauth:login-confirmed",n)},r=function(n,r){t.rejectAll(r),e.$broadcast("oauth:login-cancelled",n)},o={loginConfirmed:n,loginCancelled:r};return e.$on("oauth:login-confirmed",function(t){t.preventDefault(),e.isRefreshingToken=!1}),e.$on("oauth:login-cancelled",function(t){t.preventDefault(),e.isRefreshingToken=!1}),o}function u(e){var t,n=function(n,r){var o=function(e){r.resolve(e)},a=function(e){r.reject(e)};t=t||e.get("$http"),t(n).then(o,a)},r=function(e,t){u.push({config:e,deferred:t})},o=function(e){if(e)for(var t=0;t<u.length;++t)u[t].deferred.reject(e);u=[]},a=function(e){for(var t=0;t<u.length;++t)n(e(u[t].config),u[t].deferred);u=[]},i={append:r,rejectAll:o,retryAll:a},u=[];return i}var c=e.module("angular-oauth2",["ngStorage"]).config(n).factory("httpBuffer",u).factory("authManager",i).factory("oauthInterceptor",r).provider("OAuth",o).provider("OAuthToken",a);n.$inject=["$httpProvider"],r.$inject=["$q","$rootScope","OAuthToken","httpBuffer"];var l=function(e,t,n){t&&Object.defineProperties(e,t),n&&Object.defineProperties(e.prototype,n)},s={baseUrl:null,clientId:null,clientSecret:null,grantPath:"/oauth2/token",revokePath:"/oauth2/revoke"},f=["baseUrl","clientId","grantPath","revokePath"],l=function(e,t,n){t&&Object.defineProperties(e,t),n&&Object.defineProperties(e.prototype,n)};return i.$inject=["$rootScope","httpBuffer"],u.$inject=["$injector"],c});